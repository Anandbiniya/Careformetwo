{"version":3,"file":"bank-reconciliation-tool.min.js","sources":["../../../apps/erpnext/erpnext/public/js/bank_reconciliation_tool/data_table_manager.js","../../../apps/erpnext/erpnext/public/js/bank_reconciliation_tool/number_card.js","../../../apps/erpnext/erpnext/public/js/bank_reconciliation_tool/dialog_manager.js"],"sourcesContent":["frappe.provide(\"erpnext.accounts.bank_reconciliation\");\n\nerpnext.accounts.bank_reconciliation.DataTableManager = class DataTableManager {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t\tthis.dialog_manager = new erpnext.accounts.bank_reconciliation.DialogManager(\n\t\t\tthis.company,\n\t\t\tthis.bank_account,\n\t\t\tthis.bank_statement_from_date,\n\t\t\tthis.bank_statement_to_date,\n\t\t\tthis.filter_by_reference_date,\n\t\t\tthis.from_reference_date,\n\t\t\tthis.to_reference_date\n\t\t);\n\t\tthis.make_dt();\n\t}\n\n\tmake_dt() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.get_bank_transactions\",\n\t\t\targs: {\n\t\t\t\tbank_account: this.bank_account,\n\t\t\t\tfrom_date: this.bank_statement_from_date,\n\t\t\t\tto_date: this.bank_statement_to_date\n\t\t\t},\n\t\t\tcallback: function (response) {\n\t\t\t\tme.format_data(response.message);\n\t\t\t\tme.get_dt_columns();\n\t\t\t\tme.get_datatable();\n\t\t\t\tme.set_listeners();\n\t\t\t},\n\t\t});\n\t}\n\n\tget_dt_columns() {\n\t\tthis.columns = [\n\t\t\t{\n\t\t\t\tname: __(\"Date\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t},\n\n\t\t\t{\n\t\t\t\tname: __(\"Party Type\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 95,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Party\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Description\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 350,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Deposit\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t\tformat: (value) =>\n\t\t\t\t\t\"<span style='color:green;'>\" +\n\t\t\t\t\tformat_currency(value, this.currency) +\n\t\t\t\t\t\"</span>\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Withdrawal\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t\tformat: (value) =>\n\t\t\t\t\t\"<span style='color:red;'>\" +\n\t\t\t\t\tformat_currency(value, this.currency) +\n\t\t\t\t\t\"</span>\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Unallocated Amount\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t\tformat: (value) =>\n\t\t\t\t\t\"<span style='color:var(--blue-500);'>\" +\n\t\t\t\t\tformat_currency(value, this.currency) +\n\t\t\t\t\t\"</span>\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Reference Number\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 140,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Actions\"),\n\t\t\t\teditable: false,\n\t\t\t\tsortable: false,\n\t\t\t\tfocusable: false,\n\t\t\t\tdropdown: false,\n\t\t\t\twidth: 100,\n\t\t\t},\n\t\t];\n\t}\n\n\tformat_data(transactions) {\n\t\tthis.transactions = [];\n\t\tif (transactions[0]) {\n\t\t\tthis.currency = transactions[0][\"currency\"];\n\t\t}\n\t\tthis.transaction_dt_map = {};\n\t\tlet length;\n\t\ttransactions.forEach((row) => {\n\t\t\tlength = this.transactions.push(this.format_row(row));\n\t\t\tthis.transaction_dt_map[row[\"name\"]] = length - 1;\n\t\t});\n\t}\n\n\tformat_row(row) {\n\t\treturn [\n\t\t\trow[\"date\"],\n\t\t\trow[\"party_type\"],\n\t\t\trow[\"party\"],\n\t\t\trow[\"description\"],\n\t\t\trow[\"deposit\"],\n\t\t\trow[\"withdrawal\"],\n\t\t\trow[\"unallocated_amount\"],\n\t\t\trow[\"reference_number\"],\n\t\t\t`\n\t\t\t<Button class=\"btn btn-primary btn-xs center\"  data-name = ${row[\"name\"]} >\n\t\t\t\t${__(\"Actions\")}\n\t\t\t</a>\n\t\t\t`,\n\t\t];\n\t}\n\n\tget_datatable() {\n\t\tconst datatable_options = {\n\t\t\tcolumns: this.columns,\n\t\t\tdata: this.transactions,\n\t\t\tdynamicRowHeight: true,\n\t\t\tcheckboxColumn: false,\n\t\t\tinlineFilters: true,\n\t\t};\n\t\tthis.datatable = new frappe.DataTable(\n\t\t\tthis.$reconciliation_tool_dt.get(0),\n\t\t\tdatatable_options\n\t\t);\n\t\t$(`.${this.datatable.style.scopeClass} .dt-scrollable`).css(\n\t\t\t\"max-height\",\n\t\t\t\"calc(100vh - 400px)\"\n\t\t);\n\n\t\tif (this.transactions.length > 0) {\n\t\t\tthis.$reconciliation_tool_dt.show();\n\t\t\tthis.$no_bank_transactions.hide();\n\t\t} else {\n\t\t\tthis.$reconciliation_tool_dt.hide();\n\t\t\tthis.$no_bank_transactions.show();\n\t\t}\n\t}\n\n\tset_listeners() {\n\t\tvar me = this;\n\t\t$(`.${this.datatable.style.scopeClass} .dt-scrollable`).on(\n\t\t\t\"click\",\n\t\t\t`.btn`,\n\t\t\tfunction () {\n\t\t\t\tme.dialog_manager.show_dialog(\n\t\t\t\t\t$(this).attr(\"data-name\"),\n\t\t\t\t\t(bank_transaction) => me.update_dt_cards(bank_transaction)\n\t\t\t\t);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t);\n\t}\n\n\tupdate_dt_cards(bank_transaction) {\n\t\tconst transaction_index = this.transaction_dt_map[\n\t\t\tbank_transaction.name\n\t\t];\n\t\tif (bank_transaction.unallocated_amount > 0) {\n\t\t\tthis.transactions[transaction_index] = this.format_row(\n\t\t\t\tbank_transaction\n\t\t\t);\n\t\t} else {\n\t\t\tthis.transactions.splice(transaction_index, 1);\n\t\t\tfor (const [k, v] of Object.entries(this.transaction_dt_map)) {\n\t\t\t\tif (v > transaction_index) this.transaction_dt_map[k] = v - 1;\n\t\t\t}\n\t\t}\n\t\tthis.datatable.refresh(this.transactions, this.columns);\n\n\t\tif (this.transactions.length == 0) {\n\t\t\tthis.$reconciliation_tool_dt.hide();\n\t\t\tthis.$no_bank_transactions.show();\n\t\t}\n\n\t\t// this.make_dt();\n\t\tthis.get_cleared_balance().then(() => {\n\t\t\tthis.cards_manager.$cards[1].set_value(\n\t\t\t\tformat_currency(this.cleared_balance),\n\t\t\t\tthis.currency\n\t\t\t);\n\t\t\tthis.cards_manager.$cards[2].set_value(\n\t\t\t\tformat_currency(\n\t\t\t\t\tthis.bank_statement_closing_balance - this.cleared_balance\n\t\t\t\t),\n\t\t\t\tthis.currency\n\t\t\t);\n\t\t\tthis.cards_manager.$cards[2].set_value_color(\n\t\t\t\tthis.bank_statement_closing_balance - this.cleared_balance == 0\n\t\t\t\t\t? \"text-success\"\n\t\t\t\t\t: \"text-danger\"\n\t\t\t);\n\t\t});\n\t}\n\n\tget_cleared_balance() {\n\t\tif (this.bank_account && this.bank_statement_to_date) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod:\n\t\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.get_account_balance\",\n\t\t\t\targs: {\n\t\t\t\t\tbank_account: this.bank_account,\n\t\t\t\t\ttill_date: this.bank_statement_to_date,\n\t\t\t\t},\n\t\t\t\tcallback: (response) =>\n\t\t\t\t\t(this.cleared_balance = response.message),\n\t\t\t});\n\t\t}\n\t}\n};\n","frappe.provide(\"erpnext.accounts.bank_reconciliation\");\n\nerpnext.accounts.bank_reconciliation.NumberCardManager = class NumberCardManager {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t\tthis.make_cards();\n\t}\n\n\tmake_cards() {\n\t\tthis.$reconciliation_tool_cards.empty();\n\t\tthis.$cards = [];\n\t\tthis.$summary = $(`<div class=\"report-summary\"></div>`)\n\t\t\t.hide()\n\t\t\t.appendTo(this.$reconciliation_tool_cards);\n\t\tvar chart_data = [\n\t\t\t{\n\t\t\t\tvalue: this.bank_statement_closing_balance,\n\t\t\t\tlabel: __(\"Closing Balance as per Bank Statement\"),\n\t\t\t\tdatatype: \"Currency\",\n\t\t\t\tcurrency: this.currency,\n\t\t\t},\n\t\t\t{\n\t\t\t\tvalue: this.cleared_balance,\n\t\t\t\tlabel: __(\"Closing Balance as per ERP\"),\n\t\t\t\tdatatype: \"Currency\",\n\t\t\t\tcurrency: this.currency,\n\t\t\t},\n\t\t\t{\n\t\t\t\tvalue:\n\t\t\t\t\tthis.bank_statement_closing_balance - this.cleared_balance,\n\t\t\t\tlabel: __(\"Difference\"),\n\t\t\t\tdatatype: \"Currency\",\n\t\t\t\tcurrency: this.currency,\n\t\t\t},\n\t\t];\n\n\t\tchart_data.forEach((summary) => {\n\t\t\tlet number_card = new erpnext.accounts.NumberCard(summary);\n\t\t\tthis.$cards.push(number_card);\n\n\t\t\tnumber_card.$card.appendTo(this.$summary);\n\t\t});\n\t\tthis.$cards[2].set_value_color(\n\t\t\tthis.bank_statement_closing_balance - this.cleared_balance == 0\n\t\t\t\t? \"text-success\"\n\t\t\t\t: \"text-danger\"\n\t\t);\n\t\tthis.$summary.css({\"border-bottom\": \"0px\", \"margin-left\": \"0px\", \"margin-right\": \"0px\"});\n\t\tthis.$summary.show();\n\t}\n};\n\nerpnext.accounts.NumberCard = class NumberCard {\n\tconstructor(options) {\n\t\tthis.$card = frappe.utils.build_summary_item(options);\n\t}\n\n\tset_value(value) {\n\t\tthis.$card.find(\"div\").text(value);\n\t}\n\n\tset_value_color(color) {\n\t\tthis.$card\n\t\t\t.find(\"div\")\n\t\t\t.removeClass(\"text-danger text-success\")\n\t\t\t.addClass(`${color}`);\n\t}\n\n\tset_indicator(color) {\n\t\tthis.$card\n\t\t\t.find(\"span\")\n\t\t\t.removeClass(\"indicator red green\")\n\t\t\t.addClass(`indicator ${color}`);\n\t}\n};\n","frappe.provide(\"erpnext.accounts.bank_reconciliation\");\n\nerpnext.accounts.bank_reconciliation.DialogManager = class DialogManager {\n\tconstructor(company, bank_account, bank_statement_from_date, bank_statement_to_date, filter_by_reference_date, from_reference_date, to_reference_date) {\n\t\tthis.bank_account = bank_account;\n\t\tthis.company = company;\n\t\tthis.make_dialog();\n\t\tthis.bank_statement_from_date = bank_statement_from_date;\n\t\tthis.bank_statement_to_date = bank_statement_to_date;\n\t\tthis.filter_by_reference_date = filter_by_reference_date;\n\t\tthis.from_reference_date = from_reference_date;\n\t\tthis.to_reference_date = to_reference_date;\n\t}\n\tshow_dialog(bank_transaction_name, update_dt_cards) {\n\t\tthis.bank_transaction_name = bank_transaction_name;\n\t\tthis.update_dt_cards = update_dt_cards;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\targs: {\n\t\t\t\tdoctype: \"Bank Transaction\",\n\t\t\t\tfilters: { name: this.bank_transaction_name },\n\t\t\t\tfieldname: [\n\t\t\t\t\t\"date\",\n\t\t\t\t\t\"deposit\",\n\t\t\t\t\t\"withdrawal\",\n\t\t\t\t\t\"currency\",\n\t\t\t\t\t\"description\",\n\t\t\t\t\t\"name\",\n\t\t\t\t\t\"bank_account\",\n\t\t\t\t\t\"company\",\n\t\t\t\t\t\"reference_number\",\n\t\t\t\t\t\"party_type\",\n\t\t\t\t\t\"party\",\n\t\t\t\t\t\"unallocated_amount\",\n\t\t\t\t\t\"allocated_amount\",\n\t\t\t\t\t\"transaction_type\",\n\t\t\t\t],\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tthis.bank_transaction = r.message;\n\t\t\t\t\tr.message.payment_entry = 1;\n\t\t\t\t\tr.message.journal_entry = 1;\n\t\t\t\t\tthis.dialog.set_values(r.message);\n\t\t\t\t\tthis.copy_data_to_voucher();\n\t\t\t\t\tthis.dialog.show();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tcopy_data_to_voucher() {\n\t\tlet copied = {\n\t\t\treference_number: this.bank_transaction.reference_number || this.bank_transaction.description,\n\t\t\tposting_date: this.bank_transaction.date,\n\t\t\treference_date: this.bank_transaction.date,\n\t\t\tmode_of_payment: this.bank_transaction.transaction_type,\n\t\t};\n\t\tthis.dialog.set_values(copied);\n\t}\n\n\tget_linked_vouchers(document_types) {\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.get_linked_payments\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction_name,\n\t\t\t\tdocument_types: document_types,\n\t\t\t\tfrom_date: this.bank_statement_from_date,\n\t\t\t\tto_date: this.bank_statement_to_date,\n\t\t\t\tfilter_by_reference_date: this.filter_by_reference_date,\n\t\t\t\tfrom_reference_date:this.from_reference_date,\n\t\t\t\tto_reference_date:this.to_reference_date\n\t\t\t},\n\n\t\t\tcallback: (result) => {\n\t\t\t\tconst data = result.message;\n\n\n\t\t\t\tif (data && data.length > 0) {\n\t\t\t\t\tconst proposals_wrapper = this.dialog.fields_dict.payment_proposals.$wrapper;\n\t\t\t\t\tproposals_wrapper.show();\n\t\t\t\t\tthis.dialog.fields_dict.no_matching_vouchers.$wrapper.hide();\n\t\t\t\t\tthis.data = [];\n\t\t\t\t\tdata.forEach((row) => {\n\t\t\t\t\t\tconst reference_date = row[5] ? row[5] : row[8];\n\t\t\t\t\t\tthis.data.push([\n\t\t\t\t\t\t\trow[1],\n\t\t\t\t\t\t\trow[2],\n\t\t\t\t\t\t\treference_date,\n\t\t\t\t\t\t\tformat_currency(row[3], row[9]),\n\t\t\t\t\t\t\trow[4],\n\t\t\t\t\t\t\trow[6],\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t\tthis.get_dt_columns();\n\t\t\t\t\tthis.get_datatable(proposals_wrapper);\n\t\t\t\t} else {\n\t\t\t\t\tconst proposals_wrapper = this.dialog.fields_dict.payment_proposals.$wrapper;\n\t\t\t\t\tproposals_wrapper.hide();\n\t\t\t\t\tthis.dialog.fields_dict.no_matching_vouchers.$wrapper.show();\n\n\t\t\t\t}\n\t\t\t\tthis.dialog.show();\n\t\t\t},\n\t\t});\n\t}\n\n\tget_dt_columns() {\n\t\tthis.columns = [\n\t\t\t{\n\t\t\t\tname: __(\"Document Type\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 125,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Document Name\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Reference Date\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 120,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Remaining\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Reference Number\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 200,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: __(\"Party\"),\n\t\t\t\teditable: false,\n\t\t\t\twidth: 100,\n\t\t\t},\n\t\t];\n\t}\n\n\tget_datatable(proposals_wrapper) {\n\t\tif (!this.datatable) {\n\t\t\tconst datatable_options = {\n\t\t\t\tcolumns: this.columns,\n\t\t\t\tdata: this.data,\n\t\t\t\tdynamicRowHeight: true,\n\t\t\t\tcheckboxColumn: true,\n\t\t\t\tinlineFilters: true,\n\t\t\t};\n\t\t\tthis.datatable = new frappe.DataTable(\n\t\t\t\tproposals_wrapper.get(0),\n\t\t\t\tdatatable_options\n\t\t\t);\n\t\t} else {\n\t\t\tthis.datatable.refresh(this.data, this.columns);\n\t\t\tthis.datatable.rowmanager.checkMap = [];\n\t\t}\n\t}\n\n\tmake_dialog() {\n\t\tconst me = this;\n\t\tme.selected_payment = null;\n\n\t\tconst fields = [\n\t\t\t{\n\t\t\t\tlabel: __(\"Action\"),\n\t\t\t\tfieldname: \"action\",\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\toptions: `Match Against Voucher\\nCreate Voucher\\nUpdate Bank Transaction`,\n\t\t\t\tdefault: \"Match Against Voucher\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"column_break_4\",\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: __(\"Document Type\"),\n\t\t\t\tfieldname: \"document_type\",\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\toptions: `Payment Entry\\nJournal Entry`,\n\t\t\t\tdefault: \"Payment Entry\",\n\t\t\t\tdepends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tfieldname: \"section_break_1\",\n\t\t\t\tlabel: __(\"Filters\"),\n\t\t\t\tdepends_on: \"eval:doc.action=='Match Against Voucher'\",\n\t\t\t},\n\t\t];\n\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.bank_transaction.bank_transaction.get_doctypes_for_bank_reconciliation\",\n\t\t\tcallback: (r) => {\n\t\t\t\t$.each(r.message, (_i, entry) => {\n\t\t\t\t\tif (_i % 3 == 0) {\n\t\t\t\t\t\tfields.push({\n\t\t\t\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tfields.push({\n\t\t\t\t\t\tfieldtype: \"Check\",\n\t\t\t\t\t\tlabel: entry,\n\t\t\t\t\t\tfieldname: frappe.scrub(entry),\n\t\t\t\t\t\tonchange: () => this.update_options(),\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tfields.push(...this.get_voucher_fields());\n\n\t\t\t\tme.dialog = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __(\"Reconcile the Bank Transaction\"),\n\t\t\t\t\tfields: fields,\n\t\t\t\t\tsize: \"large\",\n\t\t\t\t\tprimary_action: (values) =>\n\t\t\t\t\t\tthis.reconciliation_dialog_primary_action(values),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_voucher_fields() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: \"Show Only Exact Amount\",\n\t\t\t\tfieldname: \"exact_match\",\n\t\t\t\tonchange: () => this.update_options(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"column_break_5\",\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Check\",\n\t\t\t\tlabel: \"Bank Transaction\",\n\t\t\t\tfieldname: \"bank_transaction\",\n\t\t\t\tonchange: () => this.update_options(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tfieldname: \"section_break_1\",\n\t\t\t\tlabel: __(\"Select Vouchers to Match\"),\n\t\t\t\tdepends_on: \"eval:doc.action=='Match Against Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\tfieldname: \"payment_proposals\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\tfieldname: \"no_matching_vouchers\",\n\t\t\t\toptions: __(\"<div class=\\\"text-muted text-center\\\">{0}</div>\", [__(\"No Matching Vouchers Found\")])\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tfieldname: \"details\",\n\t\t\t\tlabel: \"Details\",\n\t\t\t\tdepends_on: \"eval:doc.action!='Match Against Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"reference_number\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tlabel: \"Reference Number\",\n\t\t\t\tmandatory_depends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tdefault: \"Today\",\n\t\t\t\tfieldname: \"posting_date\",\n\t\t\t\tfieldtype: \"Date\",\n\t\t\t\tlabel: \"Posting Date\",\n\t\t\t\treqd: 1,\n\t\t\t\tdepends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"reference_date\",\n\t\t\t\tfieldtype: \"Date\",\n\t\t\t\tlabel: \"Cheque/Reference Date\",\n\t\t\t\tmandatory_depends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t\tdepends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t\treqd: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"mode_of_payment\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Mode of Payment\",\n\t\t\t\toptions: \"Mode of Payment\",\n\t\t\t\tdepends_on: \"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"edit_in_full_page\",\n\t\t\t\tfieldtype: \"Button\",\n\t\t\t\tlabel: \"Edit in Full Page\",\n\t\t\t\tclick: () => {\n\t\t\t\t\tthis.edit_in_full_page();\n\t\t\t\t},\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"column_break_7\",\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tdefault: \"Bank Entry\",\n\t\t\t\tfieldname: \"journal_entry_type\",\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\tlabel: \"Journal Entry Type\",\n\t\t\t\toptions:\n\t\t\t\t\t\"Journal Entry\\nInter Company Journal Entry\\nBank Entry\\nCash Entry\\nCredit Card Entry\\nDebit Note\\nCredit Note\\nContra Entry\\nExcise Entry\\nWrite Off Entry\\nOpening Entry\\nDepreciation Entry\\nExchange Rate Revaluation\\nDeferred Revenue\\nDeferred Expense\",\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Journal Entry'\",\n\t\t\t\tmandatory_depends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Journal Entry'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"second_account\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Account\",\n\t\t\t\toptions: \"Account\",\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Journal Entry'\",\n\t\t\t\tmandatory_depends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Journal Entry'\",\n\t\t\t\tget_query: () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tis_group: 0,\n\t\t\t\t\t\t\tcompany: this.company,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"party_type\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Party Type\",\n\t\t\t\toptions: \"DocType\",\n\t\t\t\tmandatory_depends_on:\n\t\t\t\t\"eval:doc.action=='Create Voucher' &&  doc.document_type=='Payment Entry'\",\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tname: [\n\t\t\t\t\t\t\t\t\"in\",\n\t\t\t\t\t\t\t\tObject.keys(frappe.boot.party_account_types),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"party\",\n\t\t\t\tfieldtype: \"Dynamic Link\",\n\t\t\t\tlabel: \"Party\",\n\t\t\t\toptions: \"party_type\",\n\t\t\t\tmandatory_depends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' && doc.document_type=='Payment Entry'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"project\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Project\",\n\t\t\t\toptions: \"Project\",\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' && doc.document_type=='Payment Entry'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"cost_center\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Cost Center\",\n\t\t\t\toptions: \"Cost Center\",\n\t\t\t\tdepends_on:\n\t\t\t\t\t\"eval:doc.action=='Create Voucher' && doc.document_type=='Payment Entry'\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldtype: \"Section Break\",\n\t\t\t\tfieldname: \"details_section\",\n\t\t\t\tlabel: \"Transaction Details\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"date\",\n\t\t\t\tfieldtype: \"Date\",\n\t\t\t\tlabel: \"Date\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"deposit\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tlabel: \"Deposit\",\n\t\t\t\toptions: \"account_currency\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"withdrawal\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tlabel: \"Withdrawal\",\n\t\t\t\toptions: \"account_currency\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"column_break_17\",\n\t\t\t\tfieldtype: \"Column Break\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"description\",\n\t\t\t\tfieldtype: \"Small Text\",\n\t\t\t\tlabel: \"Description\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"allocated_amount\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tlabel: \"Allocated Amount\",\n\t\t\t\toptions: \"account_currency\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"unallocated_amount\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tlabel: \"Unallocated Amount\",\n\t\t\t\toptions: \"account_currency\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"account_currency\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: \"Currency\",\n\t\t\t\toptions: \"Currency\",\n\t\t\t\tread_only: 1,\n\t\t\t\thidden: 1,\n\t\t\t}\n\t\t];\n\t}\n\n\tget_selected_attributes() {\n\t\tlet selected_attributes = [];\n\t\tthis.dialog.$wrapper.find(\".checkbox input\").each((i, col) => {\n\t\t\tif ($(col).is(\":checked\")) {\n\t\t\t\tselected_attributes.push($(col).attr(\"data-fieldname\"));\n\t\t\t}\n\t\t});\n\n\t\treturn selected_attributes;\n\t}\n\n\tupdate_options() {\n\t\tlet selected_attributes = this.get_selected_attributes();\n\t\tthis.get_linked_vouchers(selected_attributes);\n\t}\n\n\treconciliation_dialog_primary_action(values) {\n\t\tif (values.action == \"Match Against Voucher\") this.match(values);\n\t\tif (\n\t\t\tvalues.action == \"Create Voucher\" &&\n\t\t\tvalues.document_type == \"Payment Entry\"\n\t\t)\n\t\t\tthis.add_payment_entry(values);\n\t\tif (\n\t\t\tvalues.action == \"Create Voucher\" &&\n\t\t\tvalues.document_type == \"Journal Entry\"\n\t\t)\n\t\t\tthis.add_journal_entry(values);\n\t\telse if (values.action == \"Update Bank Transaction\")\n\t\t\tthis.update_transaction(values);\n\t}\n\n\tmatch() {\n\t\tvar selected_map = this.datatable.rowmanager.checkMap;\n\t\tlet rows = [];\n\t\tselected_map.forEach((val, index) => {\n\t\t\tif (val == 1) rows.push(this.datatable.datamanager.rows[index]);\n\t\t});\n\t\tlet vouchers = [];\n\t\trows.forEach((x) => {\n\t\t\tvouchers.push({\n\t\t\t\tpayment_doctype: x[2].content,\n\t\t\t\tpayment_name: x[3].content,\n\t\t\t\tamount: x[5].content,\n\t\t\t});\n\t\t});\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.reconcile_vouchers\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\tvouchers: vouchers,\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tconst alert_string = __(\"Bank Transaction {0} Matched\", [this.bank_transaction.name]);\n\t\t\t\tfrappe.show_alert(alert_string);\n\t\t\t\tthis.update_dt_cards(response.message);\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\tadd_payment_entry(values) {\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.create_payment_entry_bts\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\treference_number: values.reference_number,\n\t\t\t\treference_date: values.reference_date,\n\t\t\t\tparty_type: values.party_type,\n\t\t\t\tparty: values.party,\n\t\t\t\tposting_date: values.posting_date,\n\t\t\t\tmode_of_payment: values.mode_of_payment,\n\t\t\t\tproject: values.project,\n\t\t\t\tcost_center: values.cost_center,\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tconst alert_string = __(\"Bank Transaction {0} added as Payment Entry\", [this.bank_transaction.name]);\n\t\t\t\tfrappe.show_alert(alert_string);\n\t\t\t\tthis.update_dt_cards(response.message);\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\tadd_journal_entry(values) {\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.create_journal_entry_bts\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\treference_number: values.reference_number,\n\t\t\t\treference_date: values.reference_date,\n\t\t\t\tparty_type: values.party_type,\n\t\t\t\tparty: values.party,\n\t\t\t\tposting_date: values.posting_date,\n\t\t\t\tmode_of_payment: values.mode_of_payment,\n\t\t\t\tentry_type: values.journal_entry_type,\n\t\t\t\tsecond_account: values.second_account,\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tconst alert_string = __(\"Bank Transaction {0} added as Journal Entry\", [this.bank_transaction.name]);\n\t\t\t\tfrappe.show_alert(alert_string);\n\t\t\t\tthis.update_dt_cards(response.message);\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\tupdate_transaction(values) {\n\t\tfrappe.call({\n\t\t\tmethod:\n\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.update_bank_transaction\",\n\t\t\targs: {\n\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\treference_number: values.reference_number,\n\t\t\t\tparty_type: values.party_type,\n\t\t\t\tparty: values.party,\n\t\t\t},\n\t\t\tcallback: (response) => {\n\t\t\t\tconst alert_string = __(\"Bank Transaction {0} updated\", [this.bank_transaction.name]);\n\t\t\t\tfrappe.show_alert(alert_string);\n\t\t\t\tthis.update_dt_cards(response.message);\n\t\t\t\tthis.dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\tedit_in_full_page() {\n\t\tconst values = this.dialog.get_values(true);\n\t\tif (values.document_type == \"Payment Entry\") {\n\t\t\tfrappe.call({\n\t\t\t\tmethod:\n\t\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.create_payment_entry_bts\",\n\t\t\t\targs: {\n\t\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\t\treference_number: values.reference_number,\n\t\t\t\t\treference_date: values.reference_date,\n\t\t\t\t\tparty_type: values.party_type,\n\t\t\t\t\tparty: values.party,\n\t\t\t\t\tposting_date: values.posting_date,\n\t\t\t\t\tmode_of_payment: values.mode_of_payment,\n\t\t\t\t\tproject: values.project,\n\t\t\t\t\tcost_center: values.cost_center,\n\t\t\t\t\tallow_edit: true\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tconst doc = frappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", doc[0].doctype, doc[0].name);\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe.call({\n\t\t\t\tmethod:\n\t\t\t\t\t\"erpnext.accounts.doctype.bank_reconciliation_tool.bank_reconciliation_tool.create_journal_entry_bts\",\n\t\t\t\targs: {\n\t\t\t\t\tbank_transaction_name: this.bank_transaction.name,\n\t\t\t\t\treference_number: values.reference_number,\n\t\t\t\t\treference_date: values.reference_date,\n\t\t\t\t\tparty_type: values.party_type,\n\t\t\t\t\tparty: values.party,\n\t\t\t\t\tposting_date: values.posting_date,\n\t\t\t\t\tmode_of_payment: values.mode_of_payment,\n\t\t\t\t\tentry_type: values.journal_entry_type,\n\t\t\t\t\tsecond_account: values.second_account,\n\t\t\t\t\tallow_edit: true\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", doc[0].doctype, doc[0].name);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n};\n"],"names":["frappe","provide","erpnext","accounts","bank_reconciliation","DataTableManager","[object Object]","opts","Object","assign","this","dialog_manager","DialogManager","company","bank_account","bank_statement_from_date","bank_statement_to_date","filter_by_reference_date","from_reference_date","to_reference_date","make_dt","me","call","method","args","from_date","to_date","callback","response","format_data","message","get_dt_columns","get_datatable","set_listeners","columns","name","__","editable","width","format","value","format_currency","currency","sortable","focusable","dropdown","transactions","length","transaction_dt_map","forEach","row","push","format_row","const","datatable_options","data","dynamicRowHeight","checkboxColumn","inlineFilters","datatable","DataTable","$reconciliation_tool_dt","get","$","style","css","show","$no_bank_transactions","hide","on","show_dialog","attr","bank_transaction","update_dt_cards","transaction_index","unallocated_amount","splice","entries","ref","v","k","refresh","get_cleared_balance","then","cards_manager","$cards","set_value","cleared_balance","bank_statement_closing_balance","set_value_color","till_date","NumberCardManager","make_cards","$reconciliation_tool_cards","empty","$summary","appendTo","label","datatype","summary","let","number_card","NumberCard","$card","border-bottom","margin-left","margin-right","options","utils","build_summary_item","find","text","color","removeClass","addClass","make_dialog","bank_transaction_name","doctype","filters","fieldname","r","payment_entry","journal_entry","dialog","set_values","copy_data_to_voucher","copied","reference_number","description","posting_date","date","reference_date","mode_of_payment","transaction_type","document_types","result","proposals_wrapper","fields_dict","payment_proposals","$wrapper","no_matching_vouchers","rowmanager","checkMap","selected_payment","fields","fieldtype","default","depends_on","each","_i","entry","scrub","onchange","update_options","get_voucher_fields","ui","Dialog","title","size","primary_action","values","reconciliation_dialog_primary_action","mandatory_depends_on","reqd","click","edit_in_full_page","get_query","is_group","keys","boot","party_account_types","read_only","hidden","selected_attributes","i","col","is","get_selected_attributes","get_linked_vouchers","action","match","document_type","add_payment_entry","add_journal_entry","update_transaction","selected_map","rows","val","index","datamanager","vouchers","x","payment_doctype","content","payment_name","amount","alert_string","show_alert","party_type","party","project","cost_center","entry_type","journal_entry_type","second_account","get_values","allow_edit","doc","model","sync","set_route"],"mappings":"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"}